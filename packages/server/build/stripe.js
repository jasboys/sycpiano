import * as dotenv from "dotenv";
import Stripe from "stripe";
import uniqid from "uniqid";
dotenv.config({
    override: true
});
const CURRENCY = 'USD';
export const THUMBNAIL_STATIC = 'https://seanchenpiano.com/static/images/products/thumbnails/';
// const isDev = process.env.NODE_ENV === 'development';
const host = process.env.STRIPE_CALLBACK_HOST;
if (process.env.STRIPE_SECRET_KEY === undefined) {
    throw new Error('Stripe Secret Key undefined');
}
const stripe = new Stripe(process.env.STRIPE_SECRET_KEY, {
    apiVersion: '2022-11-15'
});
const stripeCustomerActive = (cr)=>{
    return cr.deleted !== true;
};
export const productIsObject = (pr)=>{
    return typeof pr !== 'string' && pr.deleted !== true;
};
export const getPricesAndProducts = async ()=>{
    try {
        const result = await stripe.products.list({
            expand: [
                'data.default_price'
            ]
        });
        return result.data;
    } catch (e) {
        console.error(e);
        throw e;
    }
};
export const getCustomer = async (email)=>{
    try {
        return (await stripe.customers.list({
            email
        })).data[0];
    } catch (e) {
        console.error(e);
        throw e;
    }
};
export const createCustomer = async (email)=>{
    try {
        return await stripe.customers.create({
            email
        });
    } catch (e) {
        console.error(e);
        throw e;
    }
};
export const getOrCreateCustomer = async (email)=>{
    try {
        const customers = await stripe.customers.list({
            email
        });
        if (customers.data.length === 0) {
            const customer = await stripe.customers.create({
                email
            });
            return customer;
        } else {
            return customers.data[0];
        }
    } catch (e) {
        console.error("Stripe create/get customer failed.", e);
        throw e;
    }
};
export const createCheckoutSession = async (productIDs, priceIDs, customerId)=>{
    try {
        const session = await stripe.checkout.sessions.create({
            mode: 'payment',
            success_url: `https://${host}/shop/checkout-success?session_id={CHECKOUT_SESSION_ID}`,
            cancel_url: `https://${host}/shop/scores`,
            payment_method_types: [
                'card'
            ],
            line_items: priceIDs.map((id)=>({
                    price: id,
                    quantity: 1
                })),
            customer: customerId,
            payment_intent_data: {
                metadata: productIDs.reduce((acc, pID, idx)=>({
                        ...acc,
                        [idx]: pID
                    }), {})
            },
            client_reference_id: uniqid.time()
        });
        return session.id;
    } catch (e) {
        console.error('Checkout session creation failed.', e);
        throw e;
    }
};
// To be destroyed
export const getProductIDsFromPaymentIntent = async (paymentIntent)=>{
    try {
        const intent = await stripe.paymentIntents.retrieve(paymentIntent);
        const metadata = Object.values(intent.metadata);
        return metadata;
    } catch (e) {
        console.error(`Couldn't get skus from paymentIntent.`, e);
        throw e;
    }
};
export const getEmailFromCustomer = async (cid)=>{
    try {
        const customer = await stripe.customers.retrieve(cid);
        if (stripeCustomerActive(customer) && customer.email) {
            return customer.email;
        } else {
            throw new Error('Customer not active, or email is empty');
        }
    } catch (e) {
        console.error(`Couldn't get email from customer.`, e);
        throw e;
    }
};
export const constructEvent = (body, sig)=>{
    if (process.env.STRIPE_WEBHOOK_KEY === undefined) {
        throw new Error('Stripe Webhook Key undefined');
    }
    const event = stripe.webhooks.constructEvent(body, sig, process.env.STRIPE_WEBHOOK_KEY);
    return event;
};
export const createProduct = async (attributes)=>{
    try {
        var _attributes_images, _product_default_price;
        const product = await stripe.products.create({
            name: attributes.name,
            description: attributes.description,
            metadata: {
                format: 'pdf',
                file: attributes.file ?? null,
                pages: attributes.pages ?? null,
                sample: attributes.sample ?? null,
                permalink: attributes.permalink ?? null,
                type: attributes.type ?? null
            },
            images: (_attributes_images = attributes.images) === null || _attributes_images === void 0 ? void 0 : _attributes_images.map((img)=>`${THUMBNAIL_STATIC}${img}`),
            default_price_data: {
                currency: CURRENCY,
                unit_amount: attributes.price
            }
        });
        const priceId = typeof product.default_price === 'string' ? product.default_price : (_product_default_price = product.default_price) === null || _product_default_price === void 0 ? void 0 : _product_default_price.id;
        if (priceId === undefined) {
            throw Error('No Price ID');
        }
        return [
            product.id,
            priceId
        ];
    } catch (e) {
        console.error(`Couldn't create product.`, e);
        throw e;
    }
};
export const deleteProduct = async (id)=>{
    try {
        return await stripe.products.del(id);
    } catch (e) {
        console.error(`Couldn't delete product. `, e);
        throw e;
    }
};
export const updateProduct = async (attributes)=>{
    try {
        var _attributes_images;
        let price = undefined;
        if (!!attributes.priceId) {
            price = await stripe.prices.retrieve(attributes.priceId);
        }
        if (price !== undefined && attributes.price !== price.unit_amount) {
            await stripe.prices.update(price.id, {
                active: false
            });
        }
        if (price === undefined || attributes.price !== price.unit_amount) {
            price = await stripe.prices.create({
                currency: CURRENCY,
                unit_amount: attributes.price,
                product: attributes.id
            });
        }
        const product = await stripe.products.update(attributes.id, {
            name: attributes.name,
            description: attributes.description,
            metadata: {
                format: 'pdf',
                file: attributes.file ?? null,
                pages: attributes.pages ?? null,
                sample: attributes.sample ?? null,
                type: attributes.type ?? null,
                permalink: attributes.permalink ?? null
            },
            images: (_attributes_images = attributes.images) === null || _attributes_images === void 0 ? void 0 : _attributes_images.map((img)=>`${THUMBNAIL_STATIC}${img}`),
            default_price: price.id
        });
        return [
            product.id,
            price.id
        ];
    } catch (e) {
        console.error(`Couldn't update product.`, e);
        throw e;
    }
};
export const getCheckoutSession = async (sessionId)=>{
    try {
        const session = await stripe.checkout.sessions.retrieve(sessionId);
        const lineItems = await stripe.checkout.sessions.listLineItems(sessionId);
        // console.log(session);
        // console.log(lineItems);
        return {
            session,
            lineItems: lineItems.data
        };
    } catch (e) {
        console.error(`Could not retrieve session with id ${sessionId}`);
        throw e;
    }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zdHJpcGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZG90ZW52IGZyb20gJ2RvdGVudic7XHJcbmltcG9ydCBTdHJpcGUgZnJvbSAnc3RyaXBlJztcclxuaW1wb3J0IHVuaXFpZCBmcm9tICd1bmlxaWQnO1xyXG5pbXBvcnQgeyBQcm9kdWN0IH0gZnJvbSAnLi9tb2RlbHMvUHJvZHVjdC5qcyc7XHJcblxyXG5kb3RlbnYuY29uZmlnKHsgb3ZlcnJpZGU6IHRydWUgfSk7XHJcblxyXG50eXBlIEN1c3RvbWVyUmV0dXJuID0gU3RyaXBlLkN1c3RvbWVyIHwgU3RyaXBlLkRlbGV0ZWRDdXN0b21lcjtcclxudHlwZSBQcm9kdWN0UmV0dXJuID0gc3RyaW5nIHwgU3RyaXBlLlByb2R1Y3QgfCBTdHJpcGUuRGVsZXRlZFByb2R1Y3Q7XHJcblxyXG5jb25zdCBDVVJSRU5DWSA9ICdVU0QnO1xyXG5leHBvcnQgY29uc3QgVEhVTUJOQUlMX1NUQVRJQyA9ICdodHRwczovL3NlYW5jaGVucGlhbm8uY29tL3N0YXRpYy9pbWFnZXMvcHJvZHVjdHMvdGh1bWJuYWlscy8nO1xyXG5cclxuLy8gY29uc3QgaXNEZXYgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JztcclxuY29uc3QgaG9zdCA9IHByb2Nlc3MuZW52LlNUUklQRV9DQUxMQkFDS19IT1NUO1xyXG5cclxuaWYgKHByb2Nlc3MuZW52LlNUUklQRV9TRUNSRVRfS0VZID09PSB1bmRlZmluZWQpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignU3RyaXBlIFNlY3JldCBLZXkgdW5kZWZpbmVkJyk7XHJcbn1cclxuY29uc3Qgc3RyaXBlOiBTdHJpcGUgPSBuZXcgU3RyaXBlKHByb2Nlc3MuZW52LlNUUklQRV9TRUNSRVRfS0VZLCB7IGFwaVZlcnNpb246ICcyMDIyLTExLTE1JyB9KTtcclxuXHJcbmNvbnN0IHN0cmlwZUN1c3RvbWVyQWN0aXZlID0gKGNyOiBDdXN0b21lclJldHVybik6IGNyIGlzIFN0cmlwZS5DdXN0b21lciA9PiB7XHJcbiAgICByZXR1cm4gY3IuZGVsZXRlZCAhPT0gdHJ1ZTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBwcm9kdWN0SXNPYmplY3QgPSAocHI6IFByb2R1Y3RSZXR1cm4pOiBwciBpcyBTdHJpcGUuUHJvZHVjdCA9PiB7XHJcbiAgICByZXR1cm4gKHR5cGVvZiBwciAhPT0gJ3N0cmluZycpICYmIHByLmRlbGV0ZWQgIT09IHRydWU7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0UHJpY2VzQW5kUHJvZHVjdHMgPSBhc3luYyAoKTogUHJvbWlzZTxTdHJpcGUuUHJvZHVjdFtdPiA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHN0cmlwZS5wcm9kdWN0cy5saXN0KHsgZXhwYW5kOiBbJ2RhdGEuZGVmYXVsdF9wcmljZSddIH0pO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQuZGF0YTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0Q3VzdG9tZXIgPSBhc3luYyAoZW1haWw6IHN0cmluZyk6IFByb21pc2U8U3RyaXBlLkN1c3RvbWVyPiA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHJldHVybiAoYXdhaXQgc3RyaXBlLmN1c3RvbWVycy5saXN0KHsgZW1haWwgfSkpLmRhdGFbMF07XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlKTtcclxuICAgICAgICB0aHJvdyBlO1xyXG4gICAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGNyZWF0ZUN1c3RvbWVyID0gYXN5bmMgKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPFN0cmlwZS5DdXN0b21lcj4gPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICByZXR1cm4gYXdhaXQgc3RyaXBlLmN1c3RvbWVycy5jcmVhdGUoeyBlbWFpbCB9KTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0T3JDcmVhdGVDdXN0b21lciA9IGFzeW5jIChlbWFpbDogc3RyaW5nKTogUHJvbWlzZTxTdHJpcGUuQ3VzdG9tZXI+ID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgY3VzdG9tZXJzID0gYXdhaXQgc3RyaXBlLmN1c3RvbWVycy5saXN0KFxyXG4gICAgICAgICAgICB7IGVtYWlsIH1cclxuICAgICAgICApO1xyXG4gICAgICAgIGlmIChjdXN0b21lcnMuZGF0YS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgY29uc3QgY3VzdG9tZXIgPSBhd2FpdCBzdHJpcGUuY3VzdG9tZXJzLmNyZWF0ZShcclxuICAgICAgICAgICAgICAgIHsgZW1haWwgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICByZXR1cm4gY3VzdG9tZXI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGN1c3RvbWVycy5kYXRhWzBdO1xyXG4gICAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiU3RyaXBlIGNyZWF0ZS9nZXQgY3VzdG9tZXIgZmFpbGVkLlwiLCBlKTtcclxuICAgICAgICB0aHJvdyBlO1xyXG4gICAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGNyZWF0ZUNoZWNrb3V0U2Vzc2lvbiA9IGFzeW5jIChwcm9kdWN0SURzOiBzdHJpbmdbXSwgcHJpY2VJRHM6IHN0cmluZ1tdLCBjdXN0b21lcklkOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4gPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgc3RyaXBlLmNoZWNrb3V0LnNlc3Npb25zLmNyZWF0ZShcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbW9kZTogJ3BheW1lbnQnLFxyXG4gICAgICAgICAgICAgICAgc3VjY2Vzc191cmw6IGBodHRwczovLyR7aG9zdH0vc2hvcC9jaGVja291dC1zdWNjZXNzP3Nlc3Npb25faWQ9e0NIRUNLT1VUX1NFU1NJT05fSUR9YCxcclxuICAgICAgICAgICAgICAgIGNhbmNlbF91cmw6IGBodHRwczovLyR7aG9zdH0vc2hvcC9zY29yZXNgLFxyXG4gICAgICAgICAgICAgICAgcGF5bWVudF9tZXRob2RfdHlwZXM6IFsnY2FyZCddLFxyXG4gICAgICAgICAgICAgICAgbGluZV9pdGVtczogcHJpY2VJRHMubWFwKChpZCkgPT5cclxuICAgICAgICAgICAgICAgICh7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJpY2U6IGlkLFxyXG4gICAgICAgICAgICAgICAgICAgIHF1YW50aXR5OiAxXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgICAgIGN1c3RvbWVyOiBjdXN0b21lcklkLFxyXG4gICAgICAgICAgICAgICAgcGF5bWVudF9pbnRlbnRfZGF0YToge1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhOiBwcm9kdWN0SURzLnJlZHVjZSgoYWNjLCBwSUQsIGlkeCkgPT4gKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLi4uYWNjLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBbaWR4XTogcElELFxyXG4gICAgICAgICAgICAgICAgICAgIH0pLCB7fSksXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgY2xpZW50X3JlZmVyZW5jZV9pZDogdW5pcWlkLnRpbWUoKSxcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIHNlc3Npb24uaWQ7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignQ2hlY2tvdXQgc2Vzc2lvbiBjcmVhdGlvbiBmYWlsZWQuJywgZSk7XHJcbiAgICAgICAgdGhyb3cgZTtcclxuICAgIH1cclxufVxyXG5cclxuLy8gVG8gYmUgZGVzdHJveWVkXHJcbmV4cG9ydCBjb25zdCBnZXRQcm9kdWN0SURzRnJvbVBheW1lbnRJbnRlbnQgPSBhc3luYyAocGF5bWVudEludGVudDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmdbXT4gPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBpbnRlbnQgPSBhd2FpdCBzdHJpcGUucGF5bWVudEludGVudHMucmV0cmlldmUocGF5bWVudEludGVudCk7XHJcbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSBPYmplY3QudmFsdWVzKGludGVudC5tZXRhZGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIG1ldGFkYXRhO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYENvdWxkbid0IGdldCBza3VzIGZyb20gcGF5bWVudEludGVudC5gLCBlKTtcclxuICAgICAgICB0aHJvdyBlO1xyXG4gICAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGdldEVtYWlsRnJvbUN1c3RvbWVyID0gYXN5bmMgKGNpZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+ID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgY3VzdG9tZXIgPSBhd2FpdCBzdHJpcGUuY3VzdG9tZXJzLnJldHJpZXZlKGNpZCk7XHJcbiAgICAgICAgaWYgKHN0cmlwZUN1c3RvbWVyQWN0aXZlKGN1c3RvbWVyKSAmJiBjdXN0b21lci5lbWFpbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY3VzdG9tZXIuZW1haWw7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDdXN0b21lciBub3QgYWN0aXZlLCBvciBlbWFpbCBpcyBlbXB0eScpO1xyXG4gICAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGBDb3VsZG4ndCBnZXQgZW1haWwgZnJvbSBjdXN0b21lci5gLCBlKTtcclxuICAgICAgICB0aHJvdyBlO1xyXG4gICAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGNvbnN0cnVjdEV2ZW50ID0gKGJvZHk6IHN0cmluZyB8IEJ1ZmZlciwgc2lnOiBzdHJpbmcgfCBzdHJpbmdbXSk6IFN0cmlwZS5FdmVudCA9PiB7XHJcbiAgICBpZiAocHJvY2Vzcy5lbnYuU1RSSVBFX1dFQkhPT0tfS0VZID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N0cmlwZSBXZWJob29rIEtleSB1bmRlZmluZWQnKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGV2ZW50ID0gc3RyaXBlLndlYmhvb2tzLmNvbnN0cnVjdEV2ZW50KGJvZHksIHNpZywgcHJvY2Vzcy5lbnYuU1RSSVBFX1dFQkhPT0tfS0VZKTtcclxuICAgIHJldHVybiBldmVudDtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBjcmVhdGVQcm9kdWN0ID0gYXN5bmMgKGF0dHJpYnV0ZXM6IFByb2R1Y3QpOiBQcm9taXNlPHN0cmluZ1tdPiA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBzdHJpcGUucHJvZHVjdHMuY3JlYXRlKHtcclxuICAgICAgICAgICAgbmFtZTogYXR0cmlidXRlcy5uYW1lLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYXR0cmlidXRlcy5kZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgICAgICAgIGZvcm1hdDogJ3BkZicsXHJcbiAgICAgICAgICAgICAgICBmaWxlOiBhdHRyaWJ1dGVzLmZpbGUgPz8gbnVsbCxcclxuICAgICAgICAgICAgICAgIHBhZ2VzOiBhdHRyaWJ1dGVzLnBhZ2VzID8/IG51bGwsXHJcbiAgICAgICAgICAgICAgICBzYW1wbGU6IGF0dHJpYnV0ZXMuc2FtcGxlID8/IG51bGwsXHJcbiAgICAgICAgICAgICAgICBwZXJtYWxpbms6IGF0dHJpYnV0ZXMucGVybWFsaW5rID8/IG51bGwsXHJcbiAgICAgICAgICAgICAgICB0eXBlOiBhdHRyaWJ1dGVzLnR5cGUgPz8gbnVsbCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaW1hZ2VzOiBhdHRyaWJ1dGVzLmltYWdlcz8ubWFwKChpbWcpID0+XHJcbiAgICAgICAgICAgICAgICBgJHtUSFVNQk5BSUxfU1RBVElDfSR7aW1nfWBcclxuICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgZGVmYXVsdF9wcmljZV9kYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW5jeTogQ1VSUkVOQ1ksXHJcbiAgICAgICAgICAgICAgICB1bml0X2Ftb3VudDogYXR0cmlidXRlcy5wcmljZSxcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnN0IHByaWNlSWQgPSAodHlwZW9mIHByb2R1Y3QuZGVmYXVsdF9wcmljZSA9PT0gJ3N0cmluZycpID8gcHJvZHVjdC5kZWZhdWx0X3ByaWNlIDogcHJvZHVjdC5kZWZhdWx0X3ByaWNlPy5pZDtcclxuICAgICAgICBpZiAocHJpY2VJZCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdObyBQcmljZSBJRCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gW3Byb2R1Y3QuaWQsIHByaWNlSWRdO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYENvdWxkbid0IGNyZWF0ZSBwcm9kdWN0LmAsIGUpO1xyXG4gICAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZGVsZXRlUHJvZHVjdCA9IGFzeW5jIChpZDogc3RyaW5nKTogUHJvbWlzZTxTdHJpcGUuUmVzcG9uc2U8U3RyaXBlLkRlbGV0ZWRQcm9kdWN0Pj4gPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICByZXR1cm4gYXdhaXQgc3RyaXBlLnByb2R1Y3RzLmRlbChpZCk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgQ291bGRuJ3QgZGVsZXRlIHByb2R1Y3QuIGAsIGUpO1xyXG4gICAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgdXBkYXRlUHJvZHVjdCA9IGFzeW5jIChhdHRyaWJ1dGVzOiBQcm9kdWN0KTogUHJvbWlzZTxzdHJpbmdbXT4gPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBsZXQgcHJpY2U6IFN0cmlwZS5QcmljZSB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICBpZiAoISFhdHRyaWJ1dGVzLnByaWNlSWQpIHtcclxuICAgICAgICAgICAgcHJpY2UgPSBhd2FpdCBzdHJpcGUucHJpY2VzLnJldHJpZXZlKGF0dHJpYnV0ZXMucHJpY2VJZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwcmljZSAhPT0gdW5kZWZpbmVkICYmIGF0dHJpYnV0ZXMucHJpY2UgIT09IHByaWNlLnVuaXRfYW1vdW50KSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHN0cmlwZS5wcmljZXMudXBkYXRlKHByaWNlLmlkLCB7IGFjdGl2ZTogZmFsc2UgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwcmljZSA9PT0gdW5kZWZpbmVkIHx8IGF0dHJpYnV0ZXMucHJpY2UgIT09IHByaWNlLnVuaXRfYW1vdW50KSB7XHJcbiAgICAgICAgICAgIHByaWNlID0gYXdhaXQgc3RyaXBlLnByaWNlcy5jcmVhdGUoe1xyXG4gICAgICAgICAgICAgICAgY3VycmVuY3k6IENVUlJFTkNZLFxyXG4gICAgICAgICAgICAgICAgdW5pdF9hbW91bnQ6IGF0dHJpYnV0ZXMucHJpY2UsXHJcbiAgICAgICAgICAgICAgICBwcm9kdWN0OiBhdHRyaWJ1dGVzLmlkLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcHJvZHVjdCA9IGF3YWl0IHN0cmlwZS5wcm9kdWN0cy51cGRhdGUoXHJcbiAgICAgICAgICAgIGF0dHJpYnV0ZXMuaWQsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG5hbWU6IGF0dHJpYnV0ZXMubmFtZSxcclxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBhdHRyaWJ1dGVzLmRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6ICdwZGYnLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGU6IGF0dHJpYnV0ZXMuZmlsZSA/PyBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VzOiBhdHRyaWJ1dGVzLnBhZ2VzID8/IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgc2FtcGxlOiBhdHRyaWJ1dGVzLnNhbXBsZSA/PyBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IGF0dHJpYnV0ZXMudHlwZSA/PyBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIHBlcm1hbGluazogYXR0cmlidXRlcy5wZXJtYWxpbmsgPz8gbnVsbCxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBpbWFnZXM6IGF0dHJpYnV0ZXMuaW1hZ2VzPy5tYXAoKGltZykgPT5cclxuICAgICAgICAgICAgICAgICAgICBgJHtUSFVNQk5BSUxfU1RBVElDfSR7aW1nfWBcclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0X3ByaWNlOiBwcmljZS5pZCxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiBbcHJvZHVjdC5pZCwgcHJpY2UuaWRdO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYENvdWxkbid0IHVwZGF0ZSBwcm9kdWN0LmAsIGUpO1xyXG4gICAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0Q2hlY2tvdXRTZXNzaW9uID0gYXN5bmMgKHNlc3Npb25JZDogc3RyaW5nKTogUHJvbWlzZTx7IHNlc3Npb246IFN0cmlwZS5DaGVja291dC5TZXNzaW9uOyBsaW5lSXRlbXM6IFN0cmlwZS5MaW5lSXRlbVtdIH0+ID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHN0cmlwZS5jaGVja291dC5zZXNzaW9ucy5yZXRyaWV2ZShzZXNzaW9uSWQpO1xyXG4gICAgICAgIGNvbnN0IGxpbmVJdGVtcyA9IGF3YWl0IHN0cmlwZS5jaGVja291dC5zZXNzaW9ucy5saXN0TGluZUl0ZW1zKHNlc3Npb25JZCk7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coc2Vzc2lvbik7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2cobGluZUl0ZW1zKTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzZXNzaW9uLFxyXG4gICAgICAgICAgICBsaW5lSXRlbXM6IGxpbmVJdGVtcy5kYXRhXHJcbiAgICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGBDb3VsZCBub3QgcmV0cmlldmUgc2Vzc2lvbiB3aXRoIGlkICR7c2Vzc2lvbklkfWApO1xyXG4gICAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbn07XHJcbiJdLCJuYW1lcyI6WyJkb3RlbnYiLCJTdHJpcGUiLCJ1bmlxaWQiLCJjb25maWciLCJvdmVycmlkZSIsIkNVUlJFTkNZIiwiVEhVTUJOQUlMX1NUQVRJQyIsImhvc3QiLCJwcm9jZXNzIiwiZW52IiwiU1RSSVBFX0NBTExCQUNLX0hPU1QiLCJTVFJJUEVfU0VDUkVUX0tFWSIsInVuZGVmaW5lZCIsIkVycm9yIiwic3RyaXBlIiwiYXBpVmVyc2lvbiIsInN0cmlwZUN1c3RvbWVyQWN0aXZlIiwiY3IiLCJkZWxldGVkIiwicHJvZHVjdElzT2JqZWN0IiwicHIiLCJnZXRQcmljZXNBbmRQcm9kdWN0cyIsInJlc3VsdCIsInByb2R1Y3RzIiwibGlzdCIsImV4cGFuZCIsImRhdGEiLCJlIiwiY29uc29sZSIsImVycm9yIiwiZ2V0Q3VzdG9tZXIiLCJlbWFpbCIsImN1c3RvbWVycyIsImNyZWF0ZUN1c3RvbWVyIiwiY3JlYXRlIiwiZ2V0T3JDcmVhdGVDdXN0b21lciIsImxlbmd0aCIsImN1c3RvbWVyIiwiY3JlYXRlQ2hlY2tvdXRTZXNzaW9uIiwicHJvZHVjdElEcyIsInByaWNlSURzIiwiY3VzdG9tZXJJZCIsInNlc3Npb24iLCJjaGVja291dCIsInNlc3Npb25zIiwibW9kZSIsInN1Y2Nlc3NfdXJsIiwiY2FuY2VsX3VybCIsInBheW1lbnRfbWV0aG9kX3R5cGVzIiwibGluZV9pdGVtcyIsIm1hcCIsImlkIiwicHJpY2UiLCJxdWFudGl0eSIsInBheW1lbnRfaW50ZW50X2RhdGEiLCJtZXRhZGF0YSIsInJlZHVjZSIsImFjYyIsInBJRCIsImlkeCIsImNsaWVudF9yZWZlcmVuY2VfaWQiLCJ0aW1lIiwiZ2V0UHJvZHVjdElEc0Zyb21QYXltZW50SW50ZW50IiwicGF5bWVudEludGVudCIsImludGVudCIsInBheW1lbnRJbnRlbnRzIiwicmV0cmlldmUiLCJPYmplY3QiLCJ2YWx1ZXMiLCJnZXRFbWFpbEZyb21DdXN0b21lciIsImNpZCIsImNvbnN0cnVjdEV2ZW50IiwiYm9keSIsInNpZyIsIlNUUklQRV9XRUJIT09LX0tFWSIsImV2ZW50Iiwid2ViaG9va3MiLCJjcmVhdGVQcm9kdWN0IiwiYXR0cmlidXRlcyIsInByb2R1Y3QiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJmb3JtYXQiLCJmaWxlIiwicGFnZXMiLCJzYW1wbGUiLCJwZXJtYWxpbmsiLCJ0eXBlIiwiaW1hZ2VzIiwiaW1nIiwiZGVmYXVsdF9wcmljZV9kYXRhIiwiY3VycmVuY3kiLCJ1bml0X2Ftb3VudCIsInByaWNlSWQiLCJkZWZhdWx0X3ByaWNlIiwiZGVsZXRlUHJvZHVjdCIsImRlbCIsInVwZGF0ZVByb2R1Y3QiLCJwcmljZXMiLCJ1cGRhdGUiLCJhY3RpdmUiLCJnZXRDaGVja291dFNlc3Npb24iLCJzZXNzaW9uSWQiLCJsaW5lSXRlbXMiLCJsaXN0TGluZUl0ZW1zIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZQSxZQUFZLFNBQVM7QUFDakMsT0FBT0MsWUFBWSxTQUFTO0FBQzVCLE9BQU9DLFlBQVksU0FBUztBQUc1QkYsT0FBT0csTUFBTSxDQUFDO0lBQUVDLFVBQVU7QUFBSztBQUsvQixNQUFNQyxXQUFXO0FBQ2pCLE9BQU8sTUFBTUMsbUJBQW1CLCtEQUErRDtBQUUvRix3REFBd0Q7QUFDeEQsTUFBTUMsT0FBT0MsUUFBUUMsR0FBRyxDQUFDQyxvQkFBb0I7QUFFN0MsSUFBSUYsUUFBUUMsR0FBRyxDQUFDRSxpQkFBaUIsS0FBS0MsV0FBVztJQUM3QyxNQUFNLElBQUlDLE1BQU07QUFDcEI7QUFDQSxNQUFNQyxTQUFpQixJQUFJYixPQUFPTyxRQUFRQyxHQUFHLENBQUNFLGlCQUFpQixFQUFFO0lBQUVJLFlBQVk7QUFBYTtBQUU1RixNQUFNQyx1QkFBdUIsQ0FBQ0M7SUFDMUIsT0FBT0EsR0FBR0MsT0FBTyxLQUFLO0FBQzFCO0FBRUEsT0FBTyxNQUFNQyxrQkFBa0IsQ0FBQ0M7SUFDNUIsT0FBTyxBQUFDLE9BQU9BLE9BQU8sWUFBYUEsR0FBR0YsT0FBTyxLQUFLO0FBQ3RELEVBQUU7QUFFRixPQUFPLE1BQU1HLHVCQUF1QjtJQUNoQyxJQUFJO1FBQ0EsTUFBTUMsU0FBUyxNQUFNUixPQUFPUyxRQUFRLENBQUNDLElBQUksQ0FBQztZQUFFQyxRQUFRO2dCQUFDO2FBQXFCO1FBQUM7UUFDM0UsT0FBT0gsT0FBT0ksSUFBSTtJQUN0QixFQUFFLE9BQU9DLEdB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